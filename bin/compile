#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir>

# Fail fast and fail hard.
set -eo pipefail


BUILD_DIR=$1
CACHE_DIR=$2

WORKING_HOME=/app

LIBRARY_PATH=$WORKING_HOME/vendor/ghc-libs:/usr/lib
LD_LIBRARY_PATH=$WORKING_HOME/vendor/ghc-libs:/usr/lib

PATH=$WORKING_HOME/vendor/ghc-$GHC_VER/bin:$WORKING_HOME/vendor/cabal-install-$CABAL_VER/bin:$WORKING_HOME/vendor/ghc-utils/bin:$WORKING_HOME/.cabal-sandbox/bin:$PATH

cabal install haste-compiler
haste-boot

haste-inst install haste-perch
haste-inst install hplayground


cd $BUILD_DIR
cabal install cpphs -j5 --disable-library-profiling --disable-executable-profiling --disable-shared  --reinstall --force-reinstalls
cabal install  -j5 --disable-library-profiling --disable-executable-profiling --disable-shared  --reinstall --force-reinstalls


